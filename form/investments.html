{% set investmentsHtml = '' %}
{% if portfolio['investments'] is defined and portfolio['investments']|length > 0 %}
    {% for amfi_code, investment in portfolio['investments'] %}
        {% set textColor = 'success' %}
        {% if investment['latest_value'] != 0 %}
            {% set latestValue = '<span class="text-' ~textColor ~ '">' ~ investment['latest_value'] ~ '</span>' %}
            {% if investment['xirr'] is defined %}
                {% if str_contains(investment['xirr'], '-') %}
                    {% set textColor = 'danger' %}
                {% endif %}
                {% set latestValue = '<span class="text-' ~textColor ~ '">' ~ investment['latest_value'] ~ ' (' ~ investment['diff'] ~ '/' ~ investment['xirr'] ~ '%)</span>' %}
            {% endif %}
        {% else %}
            {% set latestValue = '-' %}
            {% set investment['latest_value_date'] = '-' %}
        {% endif %}
        {% set investmentButtons = [] %}
        {% set investmentButtons['buy-' ~ amfi_code] = [
                'title'                   : 'Buy',
                'size'                    : 'xs',
                'buttonAdditionalClass'   : 'buyInvestment',
                'type'                    : 'success'
            ]
        %}
        {% set investmentButtons['sell-' ~ amfi_code] = [
                'title'                   : 'Sell',
                'size'                    : 'xs',
                'buttonAdditionalClass'   : 'sellInvestment',
                'type'                    : 'warning'
            ]
        %}
        {% set investmentButtons['scheme-' ~ investment['scheme_id']] = [
                'title'                   : 'Scheme',
                'size'                    : 'xs',
                'buttonAdditionalClass'   : 'schemeInvestment',
                'icon'                    : 'arrow-up-right-from-square'
            ]
        %}
        {% set investmentsHtml = investmentsHtml ~ '<tr>' ~
        '           <td>' ~ investment['scheme']['name'] ~ '</td>' ~
        '           <td>' ~ investment['units'] ~ '</td>' ~
        '           <td>' ~ investment['amount'] ~ '</td>' ~
        '           <td>' ~ investment['latest_value_date'] ~ '</td>' ~
        '           <td>' ~ latestValue ~ '</td>' ~
        '           <td>' ~ adminltetags.useTag('buttons',
                                [
                                    'component'                     : component,
                                    'componentName'                 : componentName,
                                    'componentId'                   : componentId,
                                    'parentComponentId'             : parent,
                                    'sectionId'                     : sectionId,
                                    'buttonType'                    : 'button',
                                    'buttons'                       : investmentButtons
                                ]
                            ) ~ '</td>' ~
        '   </tr>'
        %}
    {% endfor %}
{% endif %}
<div class="row" id="investments-table">
    <div class="col">
        <table id="{{componentId}}-{{sectionId}}-investments-table" class="table table-sm table-hover responsive nowrap mb-0" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th class="text-uppercase">SCHEME</th>
                    <th class="text-uppercase">UNITS</th>
                    <th class="text-uppercase">{{ currencySymbol }} AMOUNT</th>
                    <th class="text-uppercase">Latest Value Date</th>
                    <th class="text-uppercase">{{ currencySymbol }} Latest Value (Diff/Xirr)</th>
                    <th class="text-uppercase">ACTIONS</th>
                </tr>
            </thead>
            <tbody>
                {{investmentsHtml}}
            </tbody>
        </table>
    </div>
</div>